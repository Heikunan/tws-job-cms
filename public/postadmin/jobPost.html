<!DOCTYPE html>
<html>

<head>
    <metahttp-equiv="content-type" content="text/html" charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script type="text/javascript" src="../src/js/jquery-3.2.1.min.js"></script>
        <script type="text/javascript" src="../src/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="../../node_modules/wangeditor/release/wangEditor.min.js"></script>
        <script type="text/javascript" src="../../node_modules/cxselect/js/jquery.cxselect.js"></script>
        <script type="text/javascript" src="../datepicker/js/jquery-ui-datepicker.js"></script>
        <script type="text/javascript" src=" http://build.laobubu.net/MarkdownIME/MarkdownIME.js"></script>
        <link rel="stylesheet" type="text/css" href="../src/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="../src/semantic.min.css">
        <link rel="stylesheet" type="text/css" href="../src/css/jobP.css">
        <link rel="stylesheet" type="text/css" href="../datepicker/css/jquery-ui.css" />
        <script type="text/javascript">
            $.cxSelect.defaults.url = '../node_modules/cxselect/js/globalData.min.json';
            $.cxSelect.defaults.emptyStyle = 'none';
            jQuery.browser = {};
            (function () {
                jQuery.browser.msie = false;
                jQuery.browser.version = 0;
                if (navigator.userAgent.match(/MSIE ([0-9]+)\./)) {
                    jQuery.browser.msie = true;
                    jQuery.browser.version = RegExp.$1;
                }
            })();
        </script>
        
        <title>jobPost</title>
</head>

<body>
    <div class="container" style="margin: 30px 10px">
        <div class="center-block gyf">
            <form class="form-horizontal" id="gyf_myform">
                <div class="form-group">
                    <label for="gyf_post_title" class="col-sm-2 control-label">标<i class = 'space2'></i>题</label>
                    <div class="col-sm-5">
                        <input type="text" class="form-control" id="gyf_post_title" placeholder="" name="title" required="required">
                    </div>
                </div>
                <div class="form-group">
                    <label for="gyf_post_expiryTime" class="col-sm-2 control-label">截止时间</label>
                    <div class="col-sm-5">
                        <input type="text" class="form-control" name="expiryTime" id='gyf_post_expiryTime' required="required">
                    </div>
                </div>
                <div class="form-group">
                    <label for="gyf_post_category" class="col-sm-2 control-label">职业种类</label>
                    <div class="col-sm-5">
                        <select id='gyf_post_category' name='category' class="form-control">
                        <option value="程序员">程序员</option>
                        <option value="设计师">设计师</option>
                        <option value="销售经理">销售经理</option>
                        <option value="产品经理">产品经理</option>
                    </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gyf_tags_language_1" class="col-sm-2 control-label">技能需求</label>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" id="gyf_tags_language_1" placeholder="如：javascript" name="tags" required="required">
                    </div>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" id="gyf_tags_language_2" placeholder="如：html" name="tags" required="required">
                    </div>
                </div>
                <div class="form-group">
                    <label for="gyf_tags_benefits_1" class="col-sm-2 control-label">公司福利</label>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" id="gyf_tags_benefits_1" placeholder="如：五险一金" name="benefits" required="required">
                    </div>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" id="gyf_tags_benefits_2" placeholder="如：带薪休假" name="benefits" required="required">
                    </div>
                </div>
                <div class="form-group">
                    <label for="gyf_post_jobType" class="col-sm-2 control-label">工作性质</label>
                    <div class="col-sm-5">
                        <select id='gyf_post_jobType' name='jobType' class="form-control">
                            <option value="全职">全职</option>
                            <option value="兼职">兼职</option>
                            <option value="自由职业者">自由职业者</option>
                            <option value="合同协议者">合同协议者</option>
                            <option value="志愿者">志愿者</option>
                       
                    </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gyf_post_number" class="col-sm-2 control-label">招聘人数</label>
                    <div class="col-sm-5">
                        <input type="number" class="form-control" name="number" id='gyf_post_number' placeholder="如：5人" required="required">
                    </div>
                </div>
                <div class="form-group">
                    <label for="gyf_post_Educational" class="col-sm-2 control-label">学<i class = 'space2'></i>历</label>
                    <div class="col-sm-5">
                        <select id='gyf_post_Educational' name='Educational' class="form-control">
                                    <option value="初中">初中</option>
                                    <option value="高中">高中</option>
                                    <option value="专科">专科</option>
                                    <option value="本科">本科</option>
                                    <option value="硕士">硕士</option>
                                    <option value="博士">博士</option>
                            </select>
                        <!-- <input type="text" class="form-control" name="Educational" id='gyf_post_Educational' placeholder="专科"> -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="gyf_post_adress" class="col-sm-2 control-label">工作地点</label>
                    <div class="col-sm-6" id="gyf_post_adress">
                        <div class="form-inline">
                            <select class="country form-control" data-value="中国" id="gyf_post_country" name="country"></select>
                            <select class="city form-control" data-value="广东" id="gyf_post_city" name="city"></select>
                            <select class="area form-control" data-value="深圳" id="gyf_post_area" name="area"></select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gyf_post_salary" class="col-sm-2 control-label">月<i class = 'space2'></i>薪</label>
                    <div class="col-sm-5">
                        <select class="form-control" id="gyf_post_salary" name="salary">
                        <option value="0~3K">0~3K</option>
                        <option value='3k~5k'>3k~5k</option>
                        <option value="5k~8k">5k~8k</option>
                        <option value="8k~12k">8k~12k</option>
                        <option value="12k~16k">12k~16k</option>
                        <option value="16k~20k">16k~20k</option>
                        <option value="20k~50k">20k~50k</option>
                        <option value="50k以上">50k以上</option>
                    </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gyf_post_company" class="col-sm-2 control-label">公司名称</label>
                    <div class="col-sm-5">
                        <input type="text" class="form-control" id="gyf_post_company" name="company" placeholder="" disabled>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gyf_post_companyType" class="col-sm-2 control-label">公司性质</label>
                    <div class="col-sm-5">
                        <select class="form-control" id="gyf_post_companyType" name="companyType">
                                <option value="国有企业">国有企业</option>
                                <option value='私营企业'>私营企业</option>
                                <option value="集体企业">集体企业</option>
                                <option value="联营企业">联营企业</option>
                                <option value="有限责任公司">有限责任公司</option>
                                <option value="股份有限公司">股份有限公司</option>
                                <option value="股份合作企业">股份合作企业</option>
                                <option value="其他企业">其他企业</option>
                            </select>
                        <!-- <input type="text" class="form-control" id="gyf_post_companyType" name="companyType" placeholder="国营"> -->
                    </div>
                </div>

                <div class="form-group">
                    <label for="gyf_post_companySize" class="col-sm-2 control-label">公司规模</label>
                    <div class="col-sm-5">
                        <select class="form-control" id="gyf_post_companySize" name="companySize">
                        <option value="50人以下">50人以下</option>
                        <option value='50-100人'>50-100人</option>
                        <option value="100-200人">100-200人</option>
                        <option value="200-500人">200-500人</option>
                        <option value="500-800人">500-800人</option>
                        <option value="800-1000人">800-1000人</option>
                        <option value="1000人以上">1000人以上</option>
                    </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gyf_post_companyLogo" class="col-sm-2 control-label">公司图标</label>

                    <div class="col-sm-6">
                        <input type="text" class="form-control col-sm-4" id="gyf_post_companyLogo" name="companyLogo" placeholder="" disabled>
                    </div>

                    </div>
                </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label"></label>
            <button type="button" class="btn gyf_choice_btn" id="gyf_editor_wangeditor">富文本编辑器</button>
            <button type="button" class="btn gyf_choice_btn" id="gyf_editor_markdown">markdown编辑器</button>
            <a id="gyf_postJob_markdown_introduce" href="https://laobubu.net/MarkdownIME/index.zh.html" target="view_window"><span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span></a>
        </div>
        <div class="myedit-kuang">
            <div class="form-group" id="gyf_description_all">
                <label for="gyf_post_description" class="control-label">职位详情</label>
                <div id='gyf_post_description'>
                </div>
                <button type="button" class="btn gyf_view_btn" data-toggle="modal" data-target="#gyf_description_modal" id="gyf_description_view_button">预览</button>
                <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="gyf_description_modal">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content" id="gyf_description_view">

                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group" id="gyf_companyIntroduce_all">
                <label for="gyf_post_companyIntroduce" class="control-label">公司介绍</label>
                <div id='gyf_post_companyIntroduce'>

                </div>
                <button type="button" class="btn  gyf_view_btn" data-toggle="modal" data-target="#gyf_companyIntroduce_modal" id="gyf_companyIntroduce_view_button">预览</button>
                <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="gyf_companyIntroduce_modal">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content" id="gyf_companyIntroduce_view">

                        </div>
                    </div>
                </div>

            </div>
            <div class="form-group">
                <label for="gyf_post_applyApproach" class="control-label">申请方式</label>
                <div id="gyf_post_applyApproach">
                    <!-- <textarea class="form-control" rows="3" id="applyApproach" name="applyApproach"></textarea> -->
                </div>
                <button type="button" class="btn  gyf_view_btn" data-toggle="modal" data-target="#gyf_applyApproach_modal" id="gyf_applyApproach_view_button">预览</button>
                <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="gyf_applyApproach_modal">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content" id="gyf_applyApproach_view">

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-5">
                <button type="button" class="btn" style="background-color:#212121; color:white" id="gyf_post_button" onclick="">发<i class = 'space2'></i>布</button>
                <button type="button" class="btn" style="background-color:#212121; color:white" id="gyf_save_button" onclick="">保<i class = 'space2'></i>存</button>
            </div>
        </div>
        </form>
    </div>
    </div>
</body>
<script type="text/javascript">
    $.get('/getUserInfo',function (ans) {
        console.log(ans);
       if(ans){
           if(ans.company && ans.companylogo){
                 $('#gyf_post_company').val(ans.company);
                 $('#gyf_post_companyLogo').val(`upload/`+ans.companylogo)
           }else {
               alert('请完善个人信息,并上传公司logo');
           }
       }
    });
</script>

<script type="text/javascript">
            let E = window.wangEditor;
            let editor2 = new E('#gyf_post_description');
            let editor3 = new E('#gyf_post_companyIntroduce');
            let editor4 = new E('#gyf_post_applyApproach');
            editor2.customConfig.menus = [
                'head',
                'bold',
                'italic',
                'underline',
                'link',
                'list',
                'justify',
                'table',
                'undo',
                'redo'
            ];
            editor3.customConfig.menus = [
                'head',
                'bold',
                'italic',
                'underline',
                'link',
                'list',
                'justify',
                'table',
                'undo',
                'redo'
            ];
            editor4.customConfig.menus = [
                'head',
                'bold',
                'italic',
                'underline',
                'link',
                'list',
                'justify',
                'table',
                'undo',
                'redo'
            ];
            editor2.customConfig.zIndex = '1';
            editor3.customConfig.zIndex = '1';
            editor4.customConfig.zIndex = '1';
            let description;
            let companyIntroduce;
            let applyApproach;
            let choice = 0;
            $('#gyf_editor_markdown').on('click', function () {
                $('#gyf_post_description').empty();
                $('#gyf_post_companyIntroduce').empty();
                $('#gyf_post_applyApproach').empty();
                let addElement1 = `<div id="editor1" spellcheck="false" contenteditable="true"><p><br></p></div>`;
                //<pre id="logOut1"></pre>`;
                let addElement2 = `<div id="editor2" spellcheck="false" contenteditable="true"><p><br></p></div>`;
                //<pre id="logOut2"></pre>`;
                let addElement3 = `<div id="editor3" spellcheck="false" contenteditable="true"><p><br></p></div>`;
                // <pre id="logOut3"></pre>`;
                $('#gyf_post_description').append(addElement1);
                $('#gyf_post_companyIntroduce').append(addElement2);
                $('#gyf_post_applyApproach').append(addElement3);
                var editor1 = document.getElementById('editor1');
                //	var logOut1 = document.getElementById('logOut1');
                MarkdownIME.Enhance(editor1);
                editor1.focus();
                MarkdownIME.Utils.move_cursor_to_end(editor1);
                MarkdownIME.Renderer.inlineRenderer.addRule(new MarkdownIME.Addon.MathAddon());

                var editor2 = document.getElementById('editor2');
                //	var logOut2 = document.getElementById('logOut2');
                MarkdownIME.Enhance(editor2);
                editor2.focus();
                MarkdownIME.Utils.move_cursor_to_end(editor2);
                MarkdownIME.Renderer.inlineRenderer.addRule(new MarkdownIME.Addon.MathAddon());

                var editor3 = document.getElementById('editor3');
                //	var logOut3 = document.getElementById('logOut3');
                MarkdownIME.Enhance(editor3)
                editor3.focus();
                MarkdownIME.Utils.move_cursor_to_end(editor3);
                MarkdownIME.Renderer.inlineRenderer.addRule(new MarkdownIME.Addon.MathAddon());
                //Load MathAddon.
                MarkdownIME.Renderer.inlineRenderer.addRule(new MarkdownIME.Addon.MathAddon());
                // function log() {
                // 	console.log.apply(console, arguments);
                // 	var str = [].join.call(arguments, "");
                // 	var text = document.createTextNode(str + "\n");
                // 	logOut.insertBefore(text, logOut.firstChild);
                // }

                // console.log($('#editor').html());
                // description=$('#editor').html();

            });
            $('#gyf_editor_wangeditor').on('click', function () {
                $('#gyf_post_description').empty();
                $('#gyf_post_companyIntroduce').empty();
                $('#gyf_post_applyApproach').empty();
                choice = 1;
                editor2.create();
                //	description= $('#gyf_post_description>div:last-child>*').html()
                //editor2.txt.html();
                editor3.create();
                editor4.create();
            });
            $('#gyf_post_adress').cxSelect({
                url: '../node_modules/cxselect/js/globalData.min.json', // 如果服务器不支持 .json 类型文件，请将文件改为 .js 文件
                selects: ['country', 'city', 'area'],  // 数组，请注意顺序
                emptyStyle: 'none'
            });
            $(function () {
                $("#gyf_post_expiryTime").datepicker();
            });
            $('#gyf_description_view_button').on('click', function () {
                if (choice === 1) {
                    description = editor2.txt.html();
                } else {
                    description = $('#gyf_post_description>*').html();
                }
                console.log(description);
                $('#gyf_description_view').html(description);
            });
            $('#gyf_companyIntroduce_view_button').on('click', function () {
                if (choice === 1) {
                    console.log(3);
                    companyIntroduce = editor3.txt.html();
                } else {
                    companyIntroduce = $('#gyf_post_companyIntroduce>*').html();
                }
                //$('#gyf_post_companyIntroduce>div:last-child>*').html()
                $('#gyf_companyIntroduce_view').html(companyIntroduce);
            });
            $('#gyf_applyApproach_view_button').click(function () {
                if (choice === 1) {
                    console.log(4);
                    applyApproach = editor4.txt.html();
                } else {
                    applyApproach = $('#gyf_post_applyApproach>*').html();
                }

                $('#gyf_applyApproach_view').html(applyApproach);
            });
            $('#gyf_post_button').click(function (e) {
                let number = $('#gyf_myform').serialize();


                if (number.indexOf('=&')!==-1) {
                    alert("请填写全部信息");
                } else {
                    if (choice === 1) {
                        description = editor2.txt.html();
                        companyIntroduce = editor3.txt.html();
                        applyApproach = editor4.txt.html();
                    } else {
                        description = $('#gyf_post_description>*').html();
                        companyIntroduce = $('#gyf_post_companyIntroduce>*').html();
                        applyApproach = $('#gyf_post_applyApproach>*').html();
                    }
                    let datas = $('#gyf_myform').serialize();
                    let editor;
                    if(choice===1){
                        editor='fuwenben';
                    }else{
                        editor='markdown';
                    }
                    datas = datas + '&description=' + description + '&applyApproach=' + applyApproach + '&companyIntroduce=' + companyIntroduce + '&company=' + $('#gyf_post_company').val() + '&companyLogo=' + $('#gyf_post_companyLogo').val()+'&editor='+editor;
                    $.get('/getUserInfo',function (myuserinfo) {
                        //console.log(myuserinfo);
                        if(myuserinfo){
                            if(myuserinfo.company && myuserinfo.companylogo){
                                $.post('/postJob', datas).done(function (data) {
                                    console.log('inner' + data);
                                    data = data['max(id)'];
                                     alert("提交成功,等待审核");
                                    console.log(datas);
                                }).fail(function (xhr, status) {
                                    console.log('失败: ' + xhr.status + ', 原因: ' + status);
                                })
                            }else {
                                alert('请完善个人信息,并上传公司logo');
                            }
                        }
                    });
                }
            });
$('#gyf_save_button').on('click',function(){
    let number = $('#gyf_myform').serialize();
                if (number.indexOf('=&')!==-1) {
                    alert("请填写全部信息");
                } else {
                    if (choice === 1) {
                        description = editor2.txt.html();
                        companyIntroduce = editor3.txt.html();
                        applyApproach = editor4.txt.html();
                    } else {
                        description = $('#gyf_post_description>*').html();
                        companyIntroduce = $('#gyf_post_companyIntroduce>*').html();
                        applyApproach = $('#gyf_post_applyApproach>*').html();
                    }
                    let datas = $('#gyf_myform').serialize();
                    let editor;
                    if(choice===1){
                        editor='fuwenben';
                    }else{
                        editor='markdown';
                    }
                    datas = datas + '&description=' + description + '&applyApproach=' + applyApproach + '&companyIntroduce=' + companyIntroduce+'&editor='+editor;
                    $.post('/saveJob', datas).done(function (data) {
                        alert("提交成功,已经保存至草稿箱");
                        window.location.href = './drafts.html';
                    }).fail(function (xhr, status) {
                        console.log('失败: ' + xhr.status + ', 原因: ' + status);
                    })
                }
})
</script>
<script src="../js/common.js"></script>

</html>